# 충돌 처리와 길찾기

서버에서 판정을 하고 AI를 실행하기 위해 꼭 필요한 기능이다.

2.5D 상의 길찾기 알고리즘인 Navigation Mesh와 물리적인 충돌을
느슨하게 사용하는 방법이 가장 많이 쓰인다.

일부 게임에서 복셀로 전체 공간을 구조화하여 길찾기와
충돌 처리를 통합했다고 리포트한 경우가 있다.

## Navigation Mesh와 충돌 처리

Unreal 4에서 사용하는 Recast/Detour와 많은 클라이언트 게임 엔진에서 사용하는
Bullet이 있다.

AutoDesk의 Gameware 제품인 Navigation은 성능과 안정성이 뛰어나며
상호 회피, 동적인 장애물 처리, 지역 속성 등을 지원한다.

비행이나 점프가 많은 게임이 아니라면 대부분 navigation mesh에 의존하고
일부 공간 분할과 충돌 정보를 연동하여 구현할 수 있다.

### 이동과 충돌의 통합

이 쪽도 여러 가지 어려운 점들이 여전히 있다. 2D만 해도 어려운 점들이 꽤 있다.
2.5D나 3D로 가면 더 어려워진다. 점프를 포함한다면?

Navigation Mesh의 종단 Edge에 높이 정보를 포함할 수 있다.
Octree의 동적인 분할과 capsule을 사용하여 충돌을 처리할 수 있다.

위 정도로 대부분의 게임을 만들 수 있다.

FPS의 경우는 더 자세한 충돌 정보를 필요로 한다.
Bullet을 포함하여 처리한다.

## 폴리곤

네비게이션은 바닥의 폴리곤이고 충돌은 임의의 폴리곤과 방향에 의해 발생한다.
충돌 처리와 이동 처리를 폴리곤으로 통합할 수 있는 방법은 없을까?
서버에서 처리 가능한 정도로 빠르게 할 방법은 없을까?

현재 알려진 알고리즘은 GJK와 EPA 정도인데 일반적으로 처리하려면 성능이
문제가 된다. 빠르게 돌릴 수 있는 다른 기하학적인 구조는 없을까?

voxel 대신 볼륨을 사용한다면. AABB와 같아 질려나?

Octree 대신 ASDF 구조가 있다.  adaptively sampled
distance fields

## 복셀

비행이나 점프를 충돌과 길찾기를 통합해서 처리할 수 있다는 점이 매력적이다.
해상도에 따라 다르겠지만 메모리를 매우 많이 차지할 가능성이 있어
계층적인 구조화가 중요하다. 동적인 물체나 애니메이션 되는 엔티티의 복셀화와 통합은
상당히 어려울 것으로 보인다.

이 부분도 매력이 있기 때문에 알고리즘을 직접 구현해 볼 필요는 있다.

### Sparse Voxel Octree

렌더링에서 사용한 자료 구조로 voxel 단위 데이터 최적화와 메모리 구조,
contour 정보를 사용한 좀 더 상세한 곡면 근사를 목표로 해서 정리되었다.

contour 대신 차 있는 방향과 정도를 나타내는 방식을 사용하여 적은 정보로
좀 더 잘 근사시키는 시도를 해볼 수 있다.

### 이동하는 물체

동적인 복셀화가 필요하기 때문에 성능이 중요하다. 사전에 복셀로 만들고
이동된 위치에 맞추어 넣는 방법으로 가능할 것 같다.

### 외부 구현들

메모리가 계속 걸린다. 가능할까? 어느 정도 메모리를 사용하여 수천 개 인스턴스나
광활한 지역을 지원할 수 있을까?

http://www.drunkonnectar.com/3d-pathfinding-ue4/
인상적인 결과를 보여주는 시스템이다. 느슨한 구조에서는 충분히 가능하지 않을까?
언리얼 4 플러그인으로 제공되고 소스도 있다.

http://www2.informatik.uni-freiburg.de/~hornunga/pub/hornung13roscon.pdf
octomap. BSD license. 로봇을 위해 사용된 것. 느슨한 형태로 가능하지 않을까?
기본 아이디어와 코드 구현을 참조한다.

### 근사 방법

ASDF는 복셀과 표면의 충돌 정보를 포함하여 복셀 개수를 출인다.
알고리즘이 좀 더 복잡해 질 수 있다.

이보다는 표면을 근사시키는 방법으로 복셀을 줄이는 것이 좋을 듯 하다.
표면은 아무래도 매시가 더 낫다.  

## 방향

쉽지 않다. 가보지 않은 길.

navigation mesh와 voxel tree를 근간으로 하고
capsule, sphere를 voxel tree에 포함하여 ray를 포함한
충돌 처리를 구현하면 될 것 같다.

이 기반 위에 collision avoidance와 볼륨 컬러링을 추가해서 동적인 처리를 하고
그룹 이동도 그 위에 구현한다.

꽤 큰 작업이다.
