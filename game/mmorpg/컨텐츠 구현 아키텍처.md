# 컨텐츠 구현 아키텍처 

시스템 아키텍처는 대략 다음과 같이 구성할 수 있다. 

- world master
  - user handler 
    - user_system
    - ranking_system
  - scene handler
  - guild handler
  - chat handler
  - party handler 
- 프론트 서버 
  - lobby service
  - scene service
    - scene
      - game system들 
- db 서버 
  - db service

시스템 아키텍처도 여러 가지 도전 과제들이 있다. 특히, scene service를 구성하고 scene 간의 전환을 부드럽게 구성하며 인접한 scene 간에 동기화를 구현하는 것이다. seamless 서버를 분리된 scene으로 구현하는 문제는 어렵다. 

여기서는 대략의 위의 구조에서 MMORPG의 컨텐츠 구현에 대해 살펴본다. 

# lobby 처리 

- 전형적인 캐릭터 등의 처리를 한다. 
- 채팅이 가능하다. 
- 월드를 선택하고 들어오나 프론트 서버는 특정 월드에 종속되지 않는다.
- 여러 과정을 통해 진입할 지역을 선택하면 해당 프론트 서버와 연결하고 scene에 진입한다. 
  - 던전과 같이 기존에 없는 지역일 경우 생성하고 진입한다. 
  - 로비 연결은 유지한다. 
  - 해당 scene과 scene service에서 나온 후에 로비를 거쳐 다른 scene으로 진입하는 흐름을 유지한다. 

# scene 처리 

scene_handler를 통해 처리한다. 생성 / 진입 / 진출 / 소멸의 소유권을 모두 한 곳에서 가져야 버그가 없다. scene_handler가 가장 적합한 곳이다. scene_handler 모르게 또는 허락 없이 생성하거나 소멸 되지 않도록 한다. 진입 / 진출도 마찬가지로 허락을 얻어야 한다. 진입은 특히 그렇고 진출은 전달만 보장이 되면 통지로 가능하다. 

scene_handler는 scene_service들의 up / down에 따라 scene을 관리해야 한다. 















