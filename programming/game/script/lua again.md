# lua again 

- still attractive 
  - fast development
- easy to bind 
- fast 
  - slo2 even faster 
  - luajit 2.0 stable 



## 과거의 실패 

- 메모리 누수 버그 
  - luatinker의 버그와 사용 오류 
  - 루아 메모리 사용량 디버깅 
- 잦은 호출
  - update 로직을 루아에 두는 방식
  - 가끔 실행하고 풍부한 분기에 사용해야 함 
- 컴파일된 스크립트 사용과 사전 로딩 
  - 아니면 느림 
- 오류처리 
  - Lua 익셉션 처리 되지 않는 것
- 디버깅 
  - 서버내 루아 실행 디버깅 



json 으로 먼저 decision forest 를 구현해 보고 결정한다.  C++ 함수를 포함하는 expression을 조건으로 사용 가능하게 하여 기존 AI들과 동일한 효과를 내도록 한다. 



## 도메인 언어와 연동 

c++에서 주로 실행하는 도메인 언어와 결합 시켜서 처리구조를 작성하는 방법도 좋아 보인다. 자주 호출되는 부분은 데이터 위주로 C++에서 실행하고, 구성을 다양하게 해야 하는 부분을 lua로 처리한다. 

```lua
action ai_chase_simple {

when cond {
    {
    }

    when cond {
    {
    }

    when cond {
    }
}

when cond { 
}
        
}
```



별로 좋아 보이지 않는다.  c++로 한다고 해도 마찬가지 지저분해진다. 상태 외에 행동을 정의하고 처리하는 방법이 있어야 한다. 



## 방향 

lua를 sol2, luajit 조합으로 사용한다.  엔티티를 갖는 게임 처리 수준에서 연동한다.  스크립트 파일 로딩을 미리 로딩한다. VM을 안정적으로 사용할 수 있는 지 검증한다. 디버깅 연동되면 개발이 수월해진다. local 변수 사용에 주의한다. 

아주 많은 함수들과 오브젝트를 연결한다.  원하면 루아로도 개발할 수 있는 수준으로 연결한다. 타잎으로 스크립트 오브젝트를 얻어서 처리한다.  하나씩 해보면 더 많은 아이디어를 얻을 수 있다. 























