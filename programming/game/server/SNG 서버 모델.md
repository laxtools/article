# SNG 서버 모델 

SNG라고 불리는 장르는 시뮬레이션과 전략이 합해진 게임이다. 둘 사이에 다양한 변종이 있다. 대부분 웹 서버 기반으로 DB에 의존하여 요청과 응답으로 처리한다. 이와 같은 방식은 실시간 플레이가 어려워 대부분 비동기 방식의 전투나 관계를 형성한다.  

실시간 멀티플레이어 형태로 변경하면 다양한 다른 시도를 할 수 있다. 기본 세팅은 유사하게 하고 푸시 메세지로 처리하는 기능을 실시간으로 하며, 비동기 전투와 관계를 실시간으로 만든다면 다른 차원의 가능성을 확보할 수 있다. 이를 위한 구조를 생각해 본다. 



# 대략의 스펙 

룰더스카이란 SNG 게임과 클래시오브클랜을 모델로 할 수 있다.  SNG 게임은 거점에서 생산과 꾸미기를 주된 활동으로 하고, 친구 거점 방문하고 도와 주기로 관계를 맺는다. 클래시오브클랜은 전투 중심의 전략이 전체 게임의 동력이다.  자원의 생산이 병력과 방어 건물의 업그레이드를 위해 쓰인다.  전투 진행 상 건물의 배치도 전략 요소로 동작한다. 

성, 마을로 불리는 거점에서 생산과 전투 중심의 진행을 갖는, 꾸미기도 중요한, CoC (Clash of Clan)에 실시간 플레이가 가미된 게임이다. 전투와 교류는 비동기를 포함한다. 비동기로 진행하다가 사용자가 들어오면 실시간 플레이가 된다. 



# 대규모 사용자 수용 



## 기본 서비스 

프론트 서비스는 다음과 같다. 

- 인증 서비스 
- 로비 서비스 
- 인스턴스 실행 서비스 



백엔드 서비스는 다음과 같다. 

- 인스턴스 관리 서비스 
- 매칭 서비스 



## 기본 흐름 

사용자가 인증을 받으면 현재 나의 공간을 실행하고 있는 인스턴스를 안다.  만약 없다면 하나 생성하고 해당 서버로 이동한다.  인스턴스에 진입하면 현재 상태를 받는다. 상태를 받을 때 시뮬레이션이 필요하면 단계적으로 실행하여 전달한다. 만약, 교전 중이라면 전투에 직접 참여할 수 있다.  서로 제어에만 관여하고 유닛 생산은 잠근다. 미리 방어를 설정해두도록 강제한다. 제어는 미리 설정된 부대 단위, 건물 단위, 중요 유닛 단위로 할 수 있다.  너무 복잡해지지 않도록 부대 설정 개수에 제한을 둔다. 



## 매칭 

전체 사용자 정보를 검색할 필요가 있다. DB는 분산 되므로 대략적인 통계를 갖는 검색 구조를 만들 필요가 있다.  비동기 / 동기를 모두 지원하기 때문이다. 캐싱에 대한 공부가 필요하다. redis의 기능부터 보고 이를 제공할 별도의 구조가 있을 지, 어떻게 구현할 지 생각한다.  이미 있는 기능을 또 구현할 필요는 없겠으나 개선의 여지는 없는지, 충분한지는 검토해야 한다. 

정렬된 인덱스를 통한 검색이 정리되면 매칭이 가능하다.  3억 정도의 캐릭터 레코드에 대해 고민하면 될 것으로 보인다. 더 키워서 고민해도 된다. 재미있는 공부이다. 



# 캐싱과 조건 검색 리서치  

중요한 과제이고 이것만 해결되면 나머지 문제될 부분은 없다.  













